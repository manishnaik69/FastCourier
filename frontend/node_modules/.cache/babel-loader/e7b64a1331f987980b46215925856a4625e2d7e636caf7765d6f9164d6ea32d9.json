{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useContext } from 'react';\nimport { AuthContext } from '../context/AuthContext';\nexport const useAuth = () => {\n  _s();\n  var _context$user;\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  const setTokenInStorage = token => {\n    if (token) {\n      const bearerToken = token.startsWith('Bearer ') ? token : `Bearer ${token}`;\n      localStorage.setItem('token', bearerToken);\n    } else {\n      localStorage.removeItem('token');\n    }\n  };\n  const setUserInStorage = user => {\n    if (user) {\n      localStorage.setItem('user', JSON.stringify(user));\n    } else {\n      localStorage.removeItem('user');\n    }\n  };\n  const enhancedLogin = async credentials => {\n    try {\n      const response = await context.login(credentials);\n      if (!response || !response.token || !response.user) {\n        throw new Error('Invalid login response');\n      }\n      setTokenInStorage(response.token);\n      setUserInStorage(response.user);\n      return response;\n    } catch (error) {\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      throw error;\n    }\n  };\n  const enhancedLogout = () => {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    if (context.logout) {\n      context.logout();\n    }\n  };\n  const getToken = () => {\n    const token = localStorage.getItem('token');\n    return token ? token.startsWith('Bearer ') ? token : `Bearer ${token}` : null;\n  };\n  const getUser = () => {\n    try {\n      const userStr = localStorage.getItem('user');\n      return userStr ? JSON.parse(userStr) : null;\n    } catch {\n      return null;\n    }\n  };\n  const verifyAuth = async () => {\n    const token = getToken();\n    const user = getUser();\n    if (!token || !user) {\n      return false;\n    }\n    try {\n      const endpoint = user.isAdmin ? 'http://localhost:5000/api/admin/verify' : 'http://localhost:5000/api/user/profile';\n      const response = await fetch(endpoint, {\n        headers: {\n          'Authorization': token,\n          'Content-Type': 'application/json'\n        }\n      });\n      return response.ok;\n    } catch {\n      return false;\n    }\n  };\n  const updateUserProfile = async profileData => {\n    try {\n      const response = await context.updateProfile(profileData);\n      if (response !== null && response !== void 0 && response.user) {\n        setUserInStorage(response.user);\n      }\n      return response;\n    } catch (error) {\n      throw error;\n    }\n  };\n  return {\n    ...context,\n    login: enhancedLogin,\n    logout: enhancedLogout,\n    updateProfile: updateUserProfile,\n    isAuthenticated: !!context.user,\n    isAdmin: ((_context$user = context.user) === null || _context$user === void 0 ? void 0 : _context$user.isAdmin) || false,\n    getToken,\n    getUser,\n    verifyAuth,\n    setToken: setTokenInStorage,\n    setUser: setUserInStorage\n  };\n};\n_s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport default useAuth;","map":{"version":3,"names":["useContext","AuthContext","useAuth","_s","_context$user","context","Error","setTokenInStorage","token","bearerToken","startsWith","localStorage","setItem","removeItem","setUserInStorage","user","JSON","stringify","enhancedLogin","credentials","response","login","error","enhancedLogout","logout","getToken","getItem","getUser","userStr","parse","verifyAuth","endpoint","isAdmin","fetch","headers","ok","updateUserProfile","profileData","updateProfile","isAuthenticated","setToken","setUser"],"sources":["C:/Users/Asus/Desktop/cms/manish/manish1/frontend/src/hooks/useAuth.js"],"sourcesContent":["import { useContext } from 'react';\r\nimport { AuthContext } from '../context/AuthContext';\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n\r\n  const setTokenInStorage = (token) => {\r\n    if (token) {\r\n      const bearerToken = token.startsWith('Bearer ') ? token : `Bearer ${token}`;\r\n      localStorage.setItem('token', bearerToken);\r\n    } else {\r\n      localStorage.removeItem('token');\r\n    }\r\n  };\r\n\r\n  const setUserInStorage = (user) => {\r\n    if (user) {\r\n      localStorage.setItem('user', JSON.stringify(user));\r\n    } else {\r\n      localStorage.removeItem('user');\r\n    }\r\n  };\r\n\r\n  const enhancedLogin = async (credentials) => {\r\n    try {\r\n      const response = await context.login(credentials);\r\n\r\n      if (!response || !response.token || !response.user) {\r\n        throw new Error('Invalid login response');\r\n      }\r\n\r\n      setTokenInStorage(response.token);\r\n      setUserInStorage(response.user);\r\n\r\n      return response;\r\n    } catch (error) {\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('user');\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const enhancedLogout = () => {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    if (context.logout) {\r\n      context.logout();\r\n    }\r\n  };\r\n\r\n  const getToken = () => {\r\n    const token = localStorage.getItem('token');\r\n    return token ? (token.startsWith('Bearer ') ? token : `Bearer ${token}`) : null;\r\n  };\r\n\r\n  const getUser = () => {\r\n    try {\r\n      const userStr = localStorage.getItem('user');\r\n      return userStr ? JSON.parse(userStr) : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const verifyAuth = async () => {\r\n    const token = getToken();\r\n    const user = getUser();\r\n    \r\n    if (!token || !user) {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const endpoint = user.isAdmin ? \r\n        'http://localhost:5000/api/admin/verify' : \r\n        'http://localhost:5000/api/user/profile';\r\n\r\n      const response = await fetch(endpoint, {\r\n        headers: {\r\n          'Authorization': token,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      return response.ok;\r\n    } catch {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const updateUserProfile = async (profileData) => {\r\n    try {\r\n      const response = await context.updateProfile(profileData);\r\n      if (response?.user) {\r\n        setUserInStorage(response.user);\r\n      }\r\n      return response;\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  return {\r\n    ...context,\r\n    login: enhancedLogin,\r\n    logout: enhancedLogout,\r\n    updateProfile: updateUserProfile,\r\n    isAuthenticated: !!context.user,\r\n    isAdmin: context.user?.isAdmin || false,\r\n    getToken,\r\n    getUser,\r\n    verifyAuth,\r\n    setToken: setTokenInStorage,\r\n    setUser: setUserInStorage\r\n  };\r\n};\r\n\r\nexport default useAuth;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}